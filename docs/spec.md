# プロジェクト概要：暗号通貨 デルタニュートラル・FRアービトラージボット

## 1. 目的
暗号通貨の無期限先物（Perpetual）におけるファンディングレート（FR）の歪みを突き、現物買いと先物売りを同数量発注することで、価格変動リスクを排除しつつFR収益を獲得する自動売買システム。
本システムは、実運用（LIVE）、仮想運用（DRY RUN）、および過去検証（BACKTEST）の3つのモードを備える。

## 2. 技術スタック
- **言語:** Python 3.10以上
- **主要ライブラリ:**
  - `ccxt` (取引所API通信)
  - `pandas`, `numpy` (データ処理・計算)
  - `python-dotenv` (環境変数管理)
  - `matplotlib` または `plotly` (バックテスト結果のグラフ描画)
- **対象取引所:** Binance または Bybit

## 3. 動作モード（Modes）
設定ファイルまたは環境変数（`.env`）にて、以下のモードを切り替えられるように設計する。
1. **LIVE (実運用):** 実際の発注APIを叩き、リアルマネー（またはテストネット資金）で運用する。
2. **DRY_RUN (仮想運用):** リアルタイムの市場データとAIロジックを用いてシグナルを生成するが、実際の発注は行わず、現在価格で約定したと仮定して「仮想ポートフォリオ」の残高とFR収益を記録・表示する。
3. **BACKTEST (過去シミュレーション):** 過去のOHLCV（価格データ）およびFR履歴データを取得・読み込み、指定期間における戦略のパフォーマンスをシミュレーションする。

## 4. システムフロー（LIVE / DRY_RUN モード）
定期的に（例：1時間ごと）以下のサイクルを実行。

### Step 1: データ取得
- 現物および無期限先物で上場している銘柄のリスト、現在のFR、24時間出来高、現在価格、オーダーブック（スプレッド確認用）を取得。

### Step 2: スクリーニング & AI選定
- 出来高過少銘柄、FRマイナス銘柄を除外。
- AI推論用のJSONデータを作成し、FRが高く安定している銘柄を選定（初期はFR上位3銘柄を選ぶモック関数）。

### Step 3: 注文執行（モード分岐）
- **DRY_RUN時:** 発注APIは叩かず、「【DRY RUN】銘柄X: 現物仮想買い @$100, 先物仮想売り @$100.1」として仮想ポートフォリオにポジションを登録し、手数料（Taker fee）をマイナス計上する。
- **LIVE時:** 現物の成行買いと先物の成行売りを同時発注。片駆け（片方だけ約定）時の緊急決済ロジック（成行での即時クローズ）を実装。

### Step 4: ポジション監視とFR収益計算
- 保有ポジションのFR支払いタイミング（例: 8時間ごと）を監視。
- **DRY_RUN時:** FR支払い時刻を過ぎたら、仮想ポートフォリオにFR収益（または損失）を加算する。
- 終了条件（FRがマイナス転落等）を満たした場合、ポジションを決済（LIVEは実発注、DRY_RUNは仮想決済）。

## 5. バックテスト機能（BACKTEST モード）
独立したモジュールとして機能し、以下の仕様を満たす。
- **データ準備:** 指定した期間（例：過去3ヶ月）と銘柄（複数）の、1時間足OHLCVデータとFR履歴データを取引所APIから取得、またはローカルのCSVから読み込む。
- **シミュレーション実行:**
  - 過去データ上で「Step 2」のスクリーニングロジックを適用し、エントリー・エグジットのタイミングを特定。
  - 取引手数料（例: 0.1%）と推定スリッページを考慮した上で、ポジション構築コストと決済コストを計算。
  - 保有期間中に発生したFR収益を累積計算。
- **結果出力:**
  - 初期資金（例: $10,000）からの残高推移（エクイティカーブ）をグラフ描画。
  - 総取引回数、勝率（利益>コストとなった取引の割合）、最大ドローダウン、累積FR収益、総コスト（手数料等）をサマリーとしてコンソール出力またはCSV保存。

## 6. 成果物（ディレクトリ構成とファイル雛形）
以下の構成でベースコードを生成すること。
- `config.py` (モード切替 `MODE='DRY_RUN'` 等の設定)
- `fetcher.py` (リアルタイムデータおよび過去履歴データの取得)
- `screener.py` (銘柄選定ロジック・AIモック)
- `executor.py` (LIVEおよびDRY_RUNでの執行・ポートフォリオ管理ロジック)
- `backtester.py` (バックテスト実行、残高推移の計算とグラフ出力)
- `main.py` (LIVE/DRY_RUNの実行ループ)
- `.env.example`, `requirements.txt`