---
description: Agentはファイル操作の前後にdocs/*の設計書を読み・更新し、spec変更時はdocs/spec.mdを更新する
alwaysApply: true
---

# 設計書ファースト & 同期ルール

Agent がファイルを操作する際は、以下のルールを必ず守ること。

## 1. ファイル操作の前（必須）

- **コード・設定・テストなど、どのファイルを編集・作成・削除する前に**、必ず `docs/*` 以下の詳細設計書を読み込むこと。
- 該当する設計書が存在する場合は内容を確認し、設計に沿った変更を行うこと。
- 設計書が存在しない場合は、今回の変更範囲に応じて必要な設計書を `docs/` 以下に作成する計画を立てること。

## 2. ファイル操作の後（必須）

- **ファイルの編集・作成・削除を行った後は**、必ず `docs/*` 以下の詳細設計書を更新（または新規作成）すること。
- 変更内容（追加・修正・削除した機能・モジュール・API・データ構造など）を設計書に反映し、実装と設計の乖離を防ぐこと。

## 3. 仕様変更時（必須）

- **プロンプトの内容が仕様（spec）を変更する場合**は、必ず `docs/spec.md` を更新すること。
- 新機能の追加、動作モードの変更、技術スタックの変更、フローや成果物の変更など、仕様に影響する指示があった場合は、`docs/spec.md` を読み、該当箇所を修正してから実装に着手すること。

## 運用の流れ（推奨）

1. ユーザーの指示を読む → 仕様変更の有無を判断
2. 仕様変更あり → まず `docs/spec.md` を更新
3. `docs/*` の該当設計書を読む（なければ作成方針を決める）
4. 実装・ファイル操作を行う
5. 操作後、`docs/*` の設計書を更新（または新規作成）
